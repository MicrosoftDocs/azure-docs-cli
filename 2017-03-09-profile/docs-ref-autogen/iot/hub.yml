### YamlMime:AzureCLIGroup
uid: az_iot_hub
name: az iot hub
extensionInformation: >-
  > [!Note]

  > This reference is part of the **azure-iot** extension for Azure CLI and requires version 2.17.1 or higher.  The extension will automatically install the first time you run an **az iot hub** command.  [Learn more](https://docs.microsoft.com/en-us/cli/azure/azure-cli-extensions-overview) about extensions.
summary: Manage entities in an Azure IoT Hub.
description: ''
directCommands:
- uid: az_iot_hub_generate-sas-token
  name: az iot hub generate-sas-token
  summary: Generate a SAS token for a target IoT Hub, device or module.
  description: For device SAS tokens, the policy parameter is used to access the the device registry only. Therefore the policy should have read access to the registry. For IoT Hub tokens the policy is part of the SAS.
  syntax: >-
    az iot hub generate-sas-token [--auth-type {key, login}]
                                  [--connection-string]
                                  [--device-id]
                                  [--du]
                                  [--hub-name]
                                  [--key-type {primary, secondary}]
                                  [--login]
                                  [--module-id]
                                  [--pn]
                                  [--resource-group]
  examples:
  - summary: Generate an IoT Hub SAS token using the iothubowner policy and primary key.
    syntax: az iot hub generate-sas-token -n {iothub_name}
  - summary: Generate an IoT Hub SAS token using the registryRead policy and secondary key.
    syntax: az iot hub generate-sas-token -n {iothub_name} --policy registryRead --key-type secondary
  - summary: Generate a device SAS token using the iothubowner policy to access the {iothub_name} device registry.
    syntax: az iot hub generate-sas-token -d {device_id} -n {iothub_name}
  - summary: Generate a device SAS token using an IoT Hub connection string (with registry access)
    syntax: az iot hub generate-sas-token -d {device_id} --login 'HostName=myhub.azure-devices.net;SharedAccessKeyName=iothubowner;SharedAccessKey=12345'
  - summary: Generate an Iot Hub SAS token using an IoT Hub connection string
    syntax: az iot hub generate-sas-token --connection-string 'HostName=myhub.azure-devices.net;SharedAccessKeyName=iothubowner;SharedAccessKey=12345'
  - summary: Generate a Device SAS token using a Device connection string
    syntax: az iot hub generate-sas-token --connection-string 'HostName=myhub.azure-devices.net;DeviceId=mydevice;SharedAccessKeyName=iothubowner;SharedAccessKey=12345'
  - summary: Generate a Module SAS token using a Module connection string
    syntax: az iot hub generate-sas-token --connection-string 'HostName=myhub.azure-devices.net;DeviceId=mydevice;ModuleId=mymodule;SharedAccessKeyName=iothubowner;SharedAccessKey=12345'
  optionalParameters:
  - name: --auth-type
    defaultValue: key
    parameterValueGroup: key, login
    summary: Indicates whether the operation should auto-derive a policy key or use the current Azure AD session. You can configure the default using `az configure --defaults iothub-data-auth-type=<auth-type-value>`.
    description: ''
  - name: --connection-string --cs
    summary: 'Target connection string. This bypasses the IoT Hub registry and generates the SAS token directly from the supplied symmetric key without further validation. All other command parameters aside from duration will be ignored. Supported connection string types: Iot Hub, Device, Module.'
    description: ''
  - name: --device-id -d
    summary: Target Device.
    description: ''
  - name: --du --duration
    defaultValue: "3600"
    summary: Valid token duration in seconds.
    description: ''
  - name: --hub-name -n
    summary: IoT Hub name.
    description: ''
  - name: --key-type --kt
    defaultValue: primary
    parameterValueGroup: primary, secondary
    summary: Shared access policy key type for authentication.
    description: ''
  - name: --login -l
    summary: This command supports an entity connection string with rights to perform action. Use to avoid session login via "az login". If both an entity connection string and name are provided the connection string takes priority.
    description: ''
  - name: --module-id -m
    summary: Target Module.
    description: ''
  - name: --pn --policy-name
    defaultValue: iothubowner
    summary: Shared access policy with operation permissions for target IoT Hub entity.
    description: ''
  - name: --resource-group -g
    summary: Name of resource group. You can configure the default group using `az configure --defaults group=<name>`.
    description: ''
- uid: az_iot_hub_invoke-device-method
  name: az iot hub invoke-device-method
  summary: Invoke a device method.
  description: ''
  syntax: >-
    az iot hub invoke-device-method --device-id
                                    --method-name
                                    [--auth-type {key, login}]
                                    [--hub-name]
                                    [--login]
                                    [--method-payload]
                                    [--resource-group]
                                    [--timeout]
  examples:
  - summary: Invoke a direct method on device from the cloud.
    syntax: az iot hub invoke-device-method --hub-name {iothub_name} --device-id {device_id} --method-name Reboot --method-payload '{"version":"1.0"}'
  requiredParameters:
  - isRequired: true
    name: --device-id -d
    summary: Target Device.
    description: ''
  - isRequired: true
    name: --method-name --mn
    summary: Target method for invocation.
    description: ''
  optionalParameters:
  - name: --auth-type
    defaultValue: key
    parameterValueGroup: key, login
    summary: Indicates whether the operation should auto-derive a policy key or use the current Azure AD session. You can configure the default using `az configure --defaults iothub-data-auth-type=<auth-type-value>`.
    description: ''
  - name: --hub-name -n
    summary: IoT Hub name.
    description: ''
  - name: --login -l
    summary: This command supports an entity connection string with rights to perform action. Use to avoid session login via "az login". If both an entity connection string and name are provided the connection string takes priority.
    description: ''
  - name: --method-payload --mp
    defaultValue: '{}'
    summary: Json payload to be passed to method. Must be file path or raw json.
    description: ''
  - name: --resource-group -g
    summary: Name of resource group. You can configure the default group using `az configure --defaults group=<name>`.
    description: ''
  - name: --timeout --to
    defaultValue: "30"
    summary: Maximum number of seconds to wait for device method result.
    description: ''
- uid: az_iot_hub_invoke-module-method
  name: az iot hub invoke-module-method
  summary: Invoke an Edge module method.
  description: ''
  syntax: >-
    az iot hub invoke-module-method --device-id
                                    --method-name
                                    --module-id
                                    [--auth-type {key, login}]
                                    [--hub-name]
                                    [--login]
                                    [--method-payload]
                                    [--resource-group]
                                    [--timeout]
  examples:
  - summary: Invoke a direct method on edge device using a module from the cloud.
    syntax: "az iot hub invoke-module-method -n {iothub_name} -d {device_id} -m '$edgeAgent' --method-name 'RestartModule' --method-payload '{\"schemaVersion\": \"1.0\"}'"
  requiredParameters:
  - isRequired: true
    name: --device-id -d
    summary: Target Device.
    description: ''
  - isRequired: true
    name: --method-name --mn
    summary: Target method for invocation.
    description: ''
  - isRequired: true
    name: --module-id -m
    summary: Target Module.
    description: ''
  optionalParameters:
  - name: --auth-type
    defaultValue: key
    parameterValueGroup: key, login
    summary: Indicates whether the operation should auto-derive a policy key or use the current Azure AD session. You can configure the default using `az configure --defaults iothub-data-auth-type=<auth-type-value>`.
    description: ''
  - name: --hub-name -n
    summary: IoT Hub name.
    description: ''
  - name: --login -l
    summary: This command supports an entity connection string with rights to perform action. Use to avoid session login via "az login". If both an entity connection string and name are provided the connection string takes priority.
    description: ''
  - name: --method-payload --mp
    defaultValue: '{}'
    summary: Json payload to be passed to method. Must be file path or raw json.
    description: ''
  - name: --resource-group -g
    summary: Name of resource group. You can configure the default group using `az configure --defaults group=<name>`.
    description: ''
  - name: --timeout --to
    defaultValue: "30"
    summary: Maximum number of seconds to wait for device method result.
    description: ''
- uid: az_iot_hub_monitor-events
  name: az iot hub monitor-events
  summary: Monitor device telemetry & messages sent to an IoT Hub.
  description: >-
    EXPERIMENTAL requires Python 3.5+

    This command relies on and may install dependent Cython package (uamqp) upon first execution.

    https://github.com/Azure/azure-uamqp-python.
  syntax: >-
    az iot hub monitor-events [--cg]
                              [--content-type]
                              [--device-id]
                              [--device-query]
                              [--enqueued-time]
                              [--hub-name]
                              [--interface]
                              [--login]
                              [--module-id]
                              [--properties {all, anno, app, sys}]
                              [--repair {false, true}]
                              [--resource-group]
                              [--timeout]
                              [--yes {false, true}]
  examples:
  - summary: Basic usage
    syntax: az iot hub monitor-events -n {iothub_name}
  - summary: Basic usage with an IoT Hub connection string
    syntax: az iot hub monitor-events -n {iothub_name} --login 'HostName=myhub.azure-devices.net;SharedAccessKeyName=iothubowner;SharedAccessKey=12345'
  - summary: Basic usage when filtering on target device
    syntax: az iot hub monitor-events -n {iothub_name} -d {device_id}
  - summary: Basic usage when filtering targeted devices with a wildcard in the ID
    syntax: az iot hub monitor-events -n {iothub_name} -d Device*
  - summary: Filter devices using IoT Hub query language
    syntax: az iot hub monitor-events -n {iothub_name} -q "select * from devices where tags.location.region = 'US'"
  - summary: Filter device and specify an Event Hub consumer group to bind to.
    syntax: az iot hub monitor-events -n {iothub_name} -d {device_id} --cg {consumer_group_name}
  - summary: Receive message annotations (message headers)
    syntax: az iot hub monitor-events -n {iothub_name} -d {device_id} --properties anno
  - summary: Receive message annotations + system properties. Never time out.
    syntax: az iot hub monitor-events -n {iothub_name} -d {device_id} --properties anno sys --timeout 0
  - summary: Receive all message attributes from all device messages
    syntax: az iot hub monitor-events -n {iothub_name} --props all
  - summary: Receive all messages and parse message payload as JSON
    syntax: az iot hub monitor-events -n {iothub_name} --content-type application/json
  optionalParameters:
  - name: --cg --consumer-group -c
    defaultValue: $Default
    summary: Specify the consumer group to use when connecting to event hub endpoint.
    description: ''
  - name: --content-type --ct
    summary: Specify the Content-Type of the message payload to automatically format the output to that type.
    description: ''
  - name: --device-id -d
    summary: Target Device.
    description: ''
  - name: --device-query -q
    summary: Specify a custom query to filter devices.
    description: ''
  - name: --enqueued-time --et -e
    summary: Indicates the time that should be used as a starting point to read messages from the partitions. Units are milliseconds since unix epoch. If no time is indicated "now" is used.
    description: ''
  - name: --hub-name -n
    summary: IoT Hub name.
    description: ''
  - name: --interface -i
    summary: 'Target interface identifier to filter on. For example: dtmi:com:example:TemperatureController;1.'
    description: ''
  - name: --login -l
    summary: This command supports an entity connection string with rights to perform action. Use to avoid session login via "az login". If both an entity connection string and name are provided the connection string takes priority.
    description: ''
  - name: --module-id -m
    summary: Target Module.
    description: ''
  - name: --properties --props -p
    parameterValueGroup: all, anno, app, sys
    summary: Indicate key message properties to output. sys = system properties, app = application properties, anno = annotations.
    description: ''
  - name: --repair -r
    parameterValueGroup: false, true
    summary: 'Reinstall uamqp dependency compatible with extension version. Default: false.'
    description: ''
  - name: --resource-group -g
    summary: Name of resource group. You can configure the default group using `az configure --defaults group=<name>`.
    description: ''
  - name: --timeout --to -t
    defaultValue: "300"
    summary: Maximum seconds to maintain connection without receiving message. Use 0 for infinity.
    description: ''
  - name: --yes -y
    parameterValueGroup: false, true
    summary: 'Skip user prompts. Indicates acceptance of dependency installation (if required). Used primarily for automation scenarios. Default: false.'
    description: ''
- uid: az_iot_hub_monitor-feedback
  name: az iot hub monitor-feedback
  summary: Monitor feedback sent by devices to acknowledge cloud-to-device (C2D) messages.
  description: >-
    EXPERIMENTAL requires Python 3.4+

    This command relies on and may install dependent Cython package (uamqp) upon first execution.

    https://github.com/Azure/azure-uamqp-python.
  syntax: >-
    az iot hub monitor-feedback [--auth-type {key, login}]
                                [--device-id]
                                [--hub-name]
                                [--login]
                                [--repair {false, true}]
                                [--resource-group]
                                [--wait-on-msg]
                                [--yes {false, true}]
  examples:
  - summary: Basic usage
    syntax: az iot hub monitor-feedback -n {iothub_name}
  - summary: Basic usage with an IoT Hub connection string
    syntax: az iot hub monitor-feedback -n {iothub_name} --login 'HostName=myhub.azure-devices.net;SharedAccessKeyName=iothubowner;SharedAccessKey=12345'
  - summary: Basic usage when filtering on target device
    syntax: az iot hub monitor-feedback -n {iothub_name} -d {device_id}
  - summary: Exit feedback monitor upon receiving a message with specific id (uuid)
    syntax: az iot hub monitor-feedback -n {iothub_name} -d {device_id} -w {message_id}
  optionalParameters:
  - name: --auth-type
    defaultValue: key
    parameterValueGroup: key, login
    summary: Indicates whether the operation should auto-derive a policy key or use the current Azure AD session. You can configure the default using `az configure --defaults iothub-data-auth-type=<auth-type-value>`.
    description: ''
  - name: --device-id -d
    summary: Target Device.
    description: ''
  - name: --hub-name -n
    summary: IoT Hub name.
    description: ''
  - name: --login -l
    summary: This command supports an entity connection string with rights to perform action. Use to avoid session login via "az login". If both an entity connection string and name are provided the connection string takes priority.
    description: ''
  - name: --repair -r
    parameterValueGroup: false, true
    summary: 'Reinstall uamqp dependency compatible with extension version. Default: false.'
    description: ''
  - name: --resource-group -g
    summary: Name of resource group. You can configure the default group using `az configure --defaults group=<name>`.
    description: ''
  - name: --wait-on-msg -w
    summary: Feedback monitor will block until a message with specific id (uuid) is received.
    description: ''
  - name: --yes -y
    parameterValueGroup: false, true
    summary: 'Skip user prompts. Indicates acceptance of dependency installation (if required). Used primarily for automation scenarios. Default: false.'
    description: ''
- uid: az_iot_hub_query
  name: az iot hub query
  summary: Query an IoT Hub using a powerful SQL-like language.
  description: Query an IoT Hub using a powerful SQL-like language to retrieve information regarding device and module twins, jobs and message routing. See https://docs.microsoft.com/azure/iot-hub/iot-hub-devguide-query-language for more information.
  syntax: >-
    az iot hub query --query-command
                     [--auth-type {key, login}]
                     [--hub-name]
                     [--login]
                     [--resource-group]
                     [--top]
  examples:
  - summary: Query all device twin data in an Azure IoT Hub.
    syntax: az iot hub query -n {iothub_name} -q "select * from devices"
  - summary: Query all module twin data on target device.
    syntax: az iot hub query -n {iothub_name} -q "select * from devices.modules where devices.deviceId = '{device_id}'"
  requiredParameters:
  - isRequired: true
    name: --query-command -q
    summary: User query to be executed.
    description: ''
  optionalParameters:
  - name: --auth-type
    defaultValue: key
    parameterValueGroup: key, login
    summary: Indicates whether the operation should auto-derive a policy key or use the current Azure AD session. You can configure the default using `az configure --defaults iothub-data-auth-type=<auth-type-value>`.
    description: ''
  - name: --hub-name -n
    summary: IoT Hub name.
    description: ''
  - name: --login -l
    summary: This command supports an entity connection string with rights to perform action. Use to avoid session login via "az login". If both an entity connection string and name are provided the connection string takes priority.
    description: ''
  - name: --resource-group -g
    summary: Name of resource group. You can configure the default group using `az configure --defaults group=<name>`.
    description: ''
  - name: --top
    summary: Maximum number of elements to return. By default query has no cap.
    description: ''
commands:
- az_iot_hub_configuration
- az_iot_hub_configuration_create
- az_iot_hub_configuration_delete
- az_iot_hub_configuration_list
- az_iot_hub_configuration_show
- az_iot_hub_configuration_show-metric
- az_iot_hub_configuration_update
- az_iot_hub_connection-string
- az_iot_hub_connection-string_show
- az_iot_hub_device-identity
- az_iot_hub_device-identity_children
- az_iot_hub_device-identity_children_add
- az_iot_hub_device-identity_children_list
- az_iot_hub_device-identity_children_remove
- az_iot_hub_device-identity_connection-string
- az_iot_hub_device-identity_connection-string_show
- az_iot_hub_device-identity_create
- az_iot_hub_device-identity_delete
- az_iot_hub_device-identity_export
- az_iot_hub_device-identity_import
- az_iot_hub_device-identity_list
- az_iot_hub_device-identity_parent
- az_iot_hub_device-identity_parent_set
- az_iot_hub_device-identity_parent_show
- az_iot_hub_device-identity_renew-key
- az_iot_hub_device-identity_show
- az_iot_hub_device-identity_update
- az_iot_hub_device-twin
- az_iot_hub_device-twin_replace
- az_iot_hub_device-twin_show
- az_iot_hub_device-twin_update
- az_iot_hub_digital-twin
- az_iot_hub_digital-twin_invoke-command
- az_iot_hub_digital-twin_show
- az_iot_hub_digital-twin_update
- az_iot_hub_distributed-tracing
- az_iot_hub_distributed-tracing_show
- az_iot_hub_distributed-tracing_update
- az_iot_hub_generate-sas-token
- az_iot_hub_invoke-device-method
- az_iot_hub_invoke-module-method
- az_iot_hub_job
- az_iot_hub_job_cancel
- az_iot_hub_job_create
- az_iot_hub_job_list
- az_iot_hub_job_show
- az_iot_hub_module-identity
- az_iot_hub_module-identity_connection-string
- az_iot_hub_module-identity_connection-string_show
- az_iot_hub_module-identity_create
- az_iot_hub_module-identity_delete
- az_iot_hub_module-identity_list
- az_iot_hub_module-identity_renew-key
- az_iot_hub_module-identity_show
- az_iot_hub_module-identity_update
- az_iot_hub_module-twin
- az_iot_hub_module-twin_replace
- az_iot_hub_module-twin_show
- az_iot_hub_module-twin_update
- az_iot_hub_monitor-events
- az_iot_hub_monitor-feedback
- az_iot_hub_query
globalParameters:
- name: --debug
  summary: Increase logging verbosity to show all debug logs.
- name: --help -h
  summary: Show this help message and exit.
- name: --only-show-errors
  summary: Only show errors, suppressing warnings.
- name: --output -o
  defaultValue: json
  parameterValueGroup: json, jsonc, table, tsv
  summary: Output format.
- name: --query
  summary: JMESPath query string. See <a href="http://jmespath.org/">http://jmespath.org/</a> for more information and examples.
- name: --verbose
  summary: Increase logging verbosity. Use --debug for full debug logs.
metadata:
  description: Manage entities in an Azure IoT Hub.
